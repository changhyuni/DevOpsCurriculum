# Quest 07. 여러 대의 서버로 서비스 하기

## Introduction
* 이번 퀘스트는 여러 대의 서버를 통해 안정적인 서비스를 만드는 방법을 다룹니다.

## Topics

## Resources
* https://aws.amazon.com/ko/elasticloadbalancing
* `로드밸런서`와 `리스너`, 그리고 `대상그룹`와 `상태 검사`

## Checklist
* 여러 대의 서버로 서비스할 때의 장점은 무엇일까요? 또 주의해야 할 점은 무엇일까요?

여러대 서버로 서비스를 하면, 서버에 문제가 생길 경우 다른서버에서 역할을 수행할 수 있습니다. 여러대 서버인 만큼 모두 똑같은 정보를 리턴해줘야되기 때문에 동기화에 신경써야 될 것같습니다.  

* AWS에서 제공하는 로드밸런서에는 어떤 종류가 있나요? 각각의 용도는 무엇일까요?

AWS에서는 Elastic Load Balancer라는 이름으로 application 계층에서 사용하는 alb, transport 계층에서 사용하는 nlb 그리고, 두 요건을 모두 갖춘 clb로 나누어 집니다. 
alb는 http,https, 쿠키등 application 계층에서 사용되는것들을 컨트롤할 수 있고 url(path)기반으로 라우팅합니다. nlb는 tcp/udp포트 기반으로 라우팅합니다. 대표적으로 두 가지 로드벨런서 타입을 사용하고, 
가장 큰 차이점은 alb가 더 상위 계층이여서 nlb보다 속도가 느립니다. clb는 두 가지 요건을 모두사용할 수 있지만, 오래된 기술이여서 aws권고 사항이 아닙니다.  

* AWS 로드밸런서의 리스너 규칙을 이용해 어떤 일들을 할 수 있을까요?

리스너 규칙을 사용하면, if-then형식으로 받아들이는 트래픽을 조건에 따른 결과로 라우팅하거나 고정 응답도 반환할 수 있습니다. 예를 들어, 조건에 * (모든 트래픽)이 들어오면 특정한 aws 서비스로 라우팅할 수 있습니다. 
또한 모든 요청에 응답코드가 503(error) 반환되는 경우엔 `운영중이지 않는 서비스입니다` 가 적혀있는 html이나 응답 본문을 반환할 수 있습니다. 또한 리스터 응답에 대한 우선순위를 결정 할 수 있습니다.   

* AWS의 여러 리전(서울, 도쿄 등)으로 로드밸런싱을 하는 것도 가능할까요?

elb는 리전에 국한되어서 리저널하게 트래픽을 라우팅할 수 없습니다. 하지만, aws에서는 route53을 통해 gslb를 구성하거나 global acceleartor를 사용할 수 있습니다. 예시로, gslb.knowre.com 라는 네임서버를 등록하고 www에대해 route53장비로 위임(cname)하게 되면 각 리전에 결처서 사용할 수 있습니다. 


## Quest
* EC2 인스턴스를 한 대 더 늘리고, 앞단에 ELB를 사용하여 두 대를 로드밸런싱 해 보세요. 직전 퀘스트에서 만들었던 컨테이너를 이용하시면 됩니다.
* 두 대의 서버 모두에 번갈아 요청이 들어오는지 확인해 보세요.
* 만약 한 대의 서버의 컨테이너를 내렸을 때, 자동으로 나머지 한 대의 서버로만 요청이 가게 되도록 설정해 보세요. Application Load Balancer를 이용해서 구현해 봅시다!
